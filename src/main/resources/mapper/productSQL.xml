<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="product">
	<!-- 재건 -->
	<select id="selectProductList" resultType="pro">
	select * from
		(select rownum as rnum, b.* from
		(select
			p.product_no as productNo,
			expert_no as expertNo,
            (select expert_Name from expert_tbl e where p.expert_no=e.expert_no) as expertName,
			product_type as productType,
			product_title as productTitle,
            product_Category as productCategory,
			product_intro as productIntro,
			product_tag as productTag,
			product_content as productContent,
			cost,
			product_qst as productQst,
			product_ans as productAns,
			product_addr as productAddr,
			sale
			from product_tbl p 
			<choose>
			<when test="selPro=='법률'.toString()">
			where product_Category='법률'
			</when>
			<when test="selPro=='비즈니스'.toString()">
			where product_Category='비즈니스'
			</when>
			<when test="selPro=='심리/헬스'.toString()">
			where product_Category='심리/헬스'
			</when>
			<when test="selPro=='학습'.toString()">
			where product_Category='학습'
			</when>
			<when test="selPro=='금융'.toString()">
			where product_Category='금융'
			</when>
			<when test="selPro=='라이프'.toString()">
			where product_Category='라이프'
			</when>
			<when test="selPro=='취미'.toString()">
			where product_Category='취미'
			</when>
			<when test="selPro=='어학'.toString()">
			where product_Category='어학'
			</when>
			<when test="selPro=='레저'.toString()">
			where product_Category='레저'
			</when>
			<when test="selPro=='IT/테크'.toString()">
			where product_Category='IT/테크'
			</when>
			<when test="selPro=='자기개발'.toString()">
			where product_Category='자기개발'
			</when>
			</choose>
			order by p.product_no desc)b)
        	where rnum between #{start} and #{end}
	</select>

	<!-- 재건 -->
	<select id="selectTotalCount" resultType="int" parameterType="map">
		select count(*) from product_tbl
		<if test="!selPro.equals('전체')">
		 	where product_Category = #{selPro}
		</if>
  </select>
  
  <!-- 재건 -->
  <!--
  <select id=
  -->
	<!-- 윤지 -->
	<select id="selectOneProduct" parameterType="int" resultType="pro">
		select
			product_no as productNo,
			product_type as productType,
			product_title as productTitle,
	        product_Category as productCategory,
			product_intro as productIntro,
			product_tag as productTag,
			product_content as productContent,
			cost,
			product_qst as productQst,
			product_ans as productAns,
			product_addr as productAddr,
			sale,
			product_option as productOption
		from product_tbl 
        where product_no=#{productNo}
	</select>
	
	<!-- 윤지 -->
	<select id="selectAllReview" resultType="review">
		select * 
		from 
			(select rownum,n.* from(select * from review_tbl order by review_no desc)n) 
		where 
			rownum between 1 and 10

	</select>
	<!-- 윤지 -->
	<select id="selectReviewCount" resultType="int">
		select
			count(*) as cnt 
		from review_tbl
	</select>
	<!-- 윤지 -->
	<select id="selectReviewStar" resultType="int">
		select 
			AVG(review_star) 
		from 
			review_tbl
	</select>
	<!-- 윤지 -->
	<select id="selectPaymentExpertNoCount" parameterType="int" resultType="int">
		select 
			count(*) 
		from 
			payment_tbl 
		where 
			product_no=#{productNo}
	</select>
	<!-- 윤지 -->
	<select id="selectWishList" resultType="productWish">
 		select 
 			rnum, 
 			product_no as productNo, 
 			product_title as productTitle, 
 			wishcount
 		from
 			(select rownum as rnum,n.* from
				(select product_no, product_title,
    				(select nvl(count(*),0) from wishlist_tbl w where w.product_no = p.product_no) as wishCount
					from 
						product_tbl p
					order by 
			wishCount desc)n) 
		where 
			rnum between 1 and 10
 	</select> 
</mapper>
	