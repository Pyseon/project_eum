<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="community">
	<select id="selectCommunityList" resultType="comm" parameterType="map">
		select * from
			(select rownum as rnum, c.* from
			(select 
			    comm.comm_no as commNo,
			    comm_category as commCategory,
			    member_no as memberNo,
			    (select member_nick from member_tbl m where comm.member_no = m.member_no) as memberNick, --멤버닉
			    (select grade from member_tbl m where comm.member_no = m.member_no) as memberGrade, --멤버등급
			    (select member_picturepath from member_tbl m where comm.member_no = m.member_no) as memberPicturepath, --멤버프로필사진
			    comm_title as commTitle,
			    comm_intro as commIntro,
			    read_count as readCount,
			    comm_date as commDate,
			    comm_like as commLike,
			    comm_filename as commFilename,
			    comm_filepath as commFilepath,
			(select nvl(count(*),0) from communityco_tbl co where co.comm_no = comm.comm_no) as cmntCount
		from community_tbl comm 
		<if test="category != 2">
		where comm_category = #{category}
		</if>
		order by comm.comm_no desc) c)
		where rnum between #{start} and #{end}
	</select> 
	<select id="selectTotalCount" resultType="int" parameterType="map">
		select count(*) from community_tbl
		<if test="category != 2">
		where comm_category = #{category}
		</if>
	</select>
	
	<select id="communityDetail" resultType="comm" parameterType="int">
		select 
			    comm.comm_no as commNo,
			    comm_category as commCategory,
			    member_no as memberNo,
			    (select member_nick from member_tbl m where comm.member_no = m.member_no) as memberNick, --멤버닉
			    (select grade from member_tbl m where comm.member_no = m.member_no) as memberGrade, --멤버등급
			    (select member_picturepath from member_tbl m where comm.member_no = m.member_no) as memberPicturepath, --멤버프로필사진
			    comm_title as commTitle,
			    comm_intro as commIntro,
			    read_count as readCount,
			    comm_content as commContent,
			    advantage,
			    weakness,
			    comm_date as commDate,
			    comm_like as commLike,
			    comm_filename as commFilename,
			    comm_filepath as commFilepath,
			(select nvl(count(*),0) from communityco_tbl co where co.comm_no = comm.comm_no) as cmntCount
		from community_tbl comm where comm_no = ${value}
	</select> 
	
	<select id="readCountUp" parameterType="int">
		update community_tbl set read_count=read_count+1 where comm_no = ${value}
	</select> 

</mapper>
